name: Telegram Test

on:
  workflow_dispatch:  # Ch·ªâ ch·∫°y th·ªß c√¥ng

jobs:
  telegram-test:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Ch·ªâ 5 ph√∫t
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests python-dotenv
        
    - name: Create .env file
      run: |
        echo "TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}" > .env
        echo "TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}" >> .env
        
    - name: Test Telegram connection
      run: |
        python -c "
        import os
        import requests
        from datetime import datetime
        from dotenv import load_dotenv
        
        load_dotenv()
        
        TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
        TELEGRAM_CHAT_ID = os.getenv('TELEGRAM_CHAT_ID')
        
        print(f'Bot Token: {TELEGRAM_BOT_TOKEN[:20]}...')
        print(f'Chat ID: {TELEGRAM_CHAT_ID}')
        
        current_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        
        message = f'''
ü§ñ <b>TELEGRAM TEST</b>

‚úÖ <b>K·∫øt n·ªëi th√†nh c√¥ng!</b>
‚è∞ Th·ªùi gian: {current_time}
üåê Environment: GitHub Actions

üîß <b>Th√¥ng tin:</b>
‚Ä¢ Bot Token: {TELEGRAM_BOT_TOKEN[:20]}...
‚Ä¢ Chat ID: {TELEGRAM_CHAT_ID}
‚Ä¢ Status: Connected

üéâ <b>Bot ƒëang ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng!</b>
        '''
        
        url = f'https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage'
        data = {
            'chat_id': TELEGRAM_CHAT_ID,
            'text': message,
            'parse_mode': 'HTML'
        }
        
        response = requests.post(url, data=data, timeout=10)
        
        if response.status_code == 200:
            print('‚úÖ G·ª≠i message th√†nh c√¥ng!')
            print('üì± Ki·ªÉm tra Telegram ƒë·ªÉ xem message')
        else:
            print(f'‚ùå L·ªói: {response.status_code} - {response.text}')
        "
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
